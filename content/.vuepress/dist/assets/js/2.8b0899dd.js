(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{193:function(t,s,a){t.exports=a.p+"assets/img/buttonwakeup.d9a6117f.gif"},194:function(t,s,a){t.exports=a.p+"assets/img/button_plugged_in.fcf89f75.png"},195:function(t,s,a){t.exports=a.p+"assets/img/grove-button.3dee4467.png"},196:function(t,s,a){t.exports=a.p+"assets/img/systemevent.197c420d.gif"},197:function(t,s,a){t.exports=a.p+"assets/img/ble-demo.a3d8e1b0.gif"},198:function(t,s,a){t.exports=a.p+"assets/img/vue-serve.f839b7c7.png"},199:function(t,s,a){t.exports=a.p+"assets/img/curlcall.64f3b77c.gif"},200:function(t,s,a){t.exports=a.p+"assets/img/curllist.d0d65fc2.gif"},201:function(t,s,a){t.exports=a.p+"assets/img/temp.61c682e4.gif"},202:function(t,s,a){t.exports=a.p+"assets/img/particlelist.085a96a6.gif"},203:function(t,s,a){t.exports=a.p+"assets/img/particlelogin.14fc48ea.gif"},255:function(t,s,a){"use strict";a.r(s);var e=[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"lab-3-exploring-ble-and-advanced-device-os-features"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lab-3-exploring-ble-and-advanced-device-os-features","aria-hidden":"true"}},[this._v("#")]),this._v(" Lab 3: Exploring BLE and Advanced Device OS Features")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("table",[a("thead",[a("tr",[a("th",[a("strong",[t._v("Project Goal")])]),a("th",[t._v("Use BLE to broadcast device details to a web app; Use system events and sleep to respond to external inputs.")])])]),a("tbody",[a("tr",[a("td",[a("strong",[t._v("What you’ll learn")])]),a("td",[t._v("Working with Bluetooth on Particle Devices, using advanced Device OS features like threads, system events, and sleep modes.")])]),a("tr",[a("td",[a("strong",[t._v("Tools you’ll need")])]),a("td",[t._v("Particle Workbench, a Particle Argon, and the IoT Starter, The Particle CLI Kit.")])]),a("tr",[a("td",[a("strong",[t._v("Time needed to complete")])]),a("td",[t._v("60 minutes")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"exploring-the-particle-cli-and-device-cloud-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#exploring-the-particle-cli-and-device-cloud-api","aria-hidden":"true"}},[this._v("#")]),this._v(" Exploring the Particle CLI and Device Cloud API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"the-particle-cli"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#the-particle-cli","aria-hidden":"true"}},[this._v("#")]),this._v(" The Particle CLI")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("bash")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("curl")]),t._v(" -sL https://particle.io/install-cli "),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[this._v("Type "),s("code",[this._v("particle login")]),this._v(" and enter your Particle account email and password when prompted.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(203),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[this._v("Once you're logged in, type "),s("code",[this._v("particle list")]),this._v(" to see your list of online devices.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(202),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"4"}},[s("li",[this._v("The device you've been using for this workshop has two variables and one function. Get the value of the "),s("code",[this._v("temp")]),this._v(" variable with the command "),s("code",[this._v("particle get temp")]),this._v(".")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(201),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"5"}},[s("li",[this._v("You can also call one of the two functions to light up the yellow or blue LED button. Type the command "),s("code",[this._v("particle call <your-device-name> toggleLed")]),this._v(" in the terminal. Run the same command again to turn the light off.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"the-particle-device-cloud-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#the-particle-device-cloud-api","aria-hidden":"true"}},[this._v("#")]),this._v(" The Particle Device Cloud API")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ol",[a("li",[a("p",[t._v("First, you'll need to obtain an access token from the CLI. Type "),a("code",[t._v("particle token list")]),t._v(" to view the tokens associated with your account. The first one listed is your "),a("code",[t._v("user")]),t._v(" token, and can be used to access the Device Cloud API. If no tokens are listed, generate a new one with "),a("code",[t._v("particle token new")]),t._v(".")])]),a("li",[a("p",[t._v("With your token and Device ID in hand, type the following cURL command into a terminal window, replacing the text below in "),a("code",[t._v("< >")]),t._v(" with your information.")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("curl")]),this._v(" https://api.particle.io/v1/devices?access_token"),s("span",{attrs:{class:"token operator"}},[this._v("=")]),s("span",{attrs:{class:"token operator"}},[this._v("<")]),this._v("your token"),s("span",{attrs:{class:"token operator"}},[this._v(">")]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("By default, the response will generate a wall of text in your terminal. If you have Python 2.6+ installed on your machine, you can pipe the output to the "),s("code",[this._v("json.tool")]),this._v(" and get pretty-printed JSON.")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("curl")]),t._v(" https://api.particle.io/v1/devices\\?access_token\\"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("your token"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" python -m json.tool\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(200),alt:""}})])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ol",{attrs:{start:"3"}},[a("li",[a("p",[t._v("For this next command, you need the Device ID of the Photon attached to your badge. You can find that in the console or via the "),a("code",[t._v("particle list")]),t._v(" CLI command.")])]),a("li",[a("p",[t._v("Let's call the "),a("code",[t._v("toggleLed")]),t._v(" function using the Device Cloud API. Type the following, again replacing the text below in "),a("code",[t._v("< >")]),t._v(" with your information.")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("curl")]),t._v(" https://api.particle.io/v1/devices/"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("device id"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("/toggleB \\\n     -d access_token"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("your token"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(199),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"working-with-bluetooth-on-particle-devices"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#working-with-bluetooth-on-particle-devices","aria-hidden":"true"}},[this._v("#")]),this._v(" Working with Bluetooth on Particle Devices")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"using-bluetooth-with-particle-gen3-devices"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-bluetooth-with-particle-gen3-devices","aria-hidden":"true"}},[this._v("#")]),this._v(" Using Bluetooth with Particle Gen3 Devices")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[s("p",[this._v('To use Bluetooth with a Gen3 device, you\'ll need to be running Device OS version 1.3.0 or greater. To set this in Workbench, open the command palette (SHIFT + CMD/CTRL + P), select the "Configure Project for Device" option and select version "deviceOS@1.3.0" or newer.')])]),s("li",[s("p",[this._v('Next, you\'ll want to install a new library to help with getting power and battery info from your device. Open the command palette, select the "Install Library" command and enter "DiagnosticsHelperRK" into the textbox. Hit enter and the library will be installed.')])]),s("li",[s("p",[this._v("At the top of your project, add an include for the DiagnosticsHelper library.")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{attrs:{class:"token macro property"}},[this._v("#"),s("span",{attrs:{class:"token directive keyword"}},[this._v("include")]),this._v(" "),s("span",{attrs:{class:"token string"}},[this._v('"DiagnosticsHelperRK.h"')])]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"4"}},[s("li",[this._v("Now, let's turn on threading in the app, using the "),s("code",[this._v("SYSTEM_THREAD")]),this._v(" command below. This opt-in change will allow your user firmware and system firmware to run on separate threads, which can speed things up when you're doing cloud publishes and local operations like Bluetooth.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("SYSTEM_THREAD(ENABLED);\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"5"}},[s("li",[this._v("Next, add some global variables to handle timing for updating the device state values outside of the "),s("code",[this._v("setup")]),this._v(" and "),s("code",[this._v("loop")]),this._v(" functions.")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("unsigned")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("long")]),t._v(" UPDATE_INTERVAL "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("2000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("unsigned")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("long")]),t._v(" lastUpdate "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// Private battery and power service UUID")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" BleUuid "),a("span",{attrs:{class:"token function"}},[t._v("serviceUuid")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"5c1b9a0d-b5be-4a40-8f7a-66b36d0a5176"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// CHANGE ME")]),t._v("\n\nBleCharacteristic "),a("span",{attrs:{class:"token function"}},[t._v("uptimeCharacteristic")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"uptime"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BleCharacteristicProperty"),a("span",{attrs:{class:"token operator"}},[t._v("::")]),t._v("NOTIFY"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("BleUuid")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"fdcf4a3f-3fed-4ed2-84e6-04bbb9ae04d4"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" serviceUuid"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nBleCharacteristic "),a("span",{attrs:{class:"token function"}},[t._v("signalStrengthCharacteristic")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"strength"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BleCharacteristicProperty"),a("span",{attrs:{class:"token operator"}},[t._v("::")]),t._v("NOTIFY"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("BleUuid")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"cc97c20c-5822-4800-ade5-1f661d2133ee"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" serviceUuid"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nBleCharacteristic "),a("span",{attrs:{class:"token function"}},[t._v("freeMemoryCharacteristic")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"freeMemory"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BleCharacteristicProperty"),a("span",{attrs:{class:"token operator"}},[t._v("::")]),t._v("NOTIFY"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("BleUuid")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"d2b26bf3-9792-42fc-9e8a-41f6107df04c"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" serviceUuid"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"7"}},[s("li",[this._v("Next, create a function to configure and set-up BLE advertising from your device. This snippet will add the three characteristics you defined above, as well as the service UUID you specified, and will advertise itself as a connectable device.")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("configureBLE")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  BLE"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("addCharacteristic")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uptimeCharacteristic"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  BLE"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("addCharacteristic")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("signalStrengthCharacteristic"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  BLE"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("addCharacteristic")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("freeMemoryCharacteristic"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  BleAdvertisingData advData"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// Advertise our private service only")]),t._v("\n  advData"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("appendServiceUUID")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serviceUuid"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// Continuously advertise when not connected")]),t._v("\n  BLE"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("advertise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("advData"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"8"}},[s("li",[this._v("At the end of your "),s("code",[this._v("setup")]),this._v(" function, call the function you just created.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("configureBLE")]),s("span",{attrs:{class:"token punctuation"}},[this._v("(")]),s("span",{attrs:{class:"token punctuation"}},[this._v(")")]),s("span",{attrs:{class:"token punctuation"}},[this._v(";")]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"refactoring-out-the-blocking-delay"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#refactoring-out-the-blocking-delay","aria-hidden":"true"}},[this._v("#")]),this._v(" Refactoring out the blocking delay")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Next, let's modify the "),s("code",[this._v("loop")]),this._v(" function. We'll start by refactoring our firmware to remove the "),s("code",[this._v("delay")]),this._v(" in the loop. While the delay approach is common when getting started with creating embedded applications, it's a blocking operation. This means that any calls you make to the device during a delay may timeout before being received.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("One common way to write periodic code without using "),s("code",[this._v("delay")]),this._v(" is to use the built-in "),s("code",[this._v("millis()")]),this._v(" function and keep track of the elapsed time between the last time you performed an operation (like a temp check) and the wait time between operations.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("First, let's add some global variables to hold the last check time and an interval. Add the following to the top of your project, outside of the "),s("code",[this._v("setup")]),this._v(" and "),s("code",[this._v("loop")]),this._v(".")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("unsigned")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("long")]),t._v(" UPDATE_INTERVAL "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("2000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("unsigned")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("long")]),t._v(" lastUpdate "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[this._v("Now, in the "),s("code",[this._v("loop")]),this._v(", add a local variable to hold the current time elapsed. The "),s("code",[this._v("millis()")]),this._v(" function returns the number of milliseconds that have elapsed since your device began running the current program.")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("unsigned")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("long")]),t._v(" currentMillis "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("millis")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[this._v("Next, remove the "),s("code",[this._v("delay")]),this._v(" at the end of your loop function. Then, wrap the rest of the code with an if statement to see if the "),s("code",[this._v("UPDATE_INTERVAL")]),this._v(" time has elapsed.")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("Make sure you also update the "),a("code",[t._v("lastUpdate")]),t._v(" variable to the current "),a("code",[t._v("millis")]),t._v(" time or this "),a("code",[t._v("if")]),t._v(" statement will never evaluate to "),a("code",[t._v("true")]),t._v(" after the first time it runs.")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentMillis "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v(" lastUpdate "),a("span",{attrs:{class:"token operator"}},[t._v(">=")]),t._v(" UPDATE_INTERVAL"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  lastUpdate "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("millis")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[t._v("/* rest of Loop code here */")]),t._v(" \n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Your "),s("code",[this._v("loop")]),this._v(" should now look like this:")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("loop")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("unsigned")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("long")]),t._v(" currentMillis "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("millis")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentMillis "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v(" lastUpdate "),a("span",{attrs:{class:"token operator"}},[t._v(">=")]),t._v(" UPDATE_INTERVAL"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    lastUpdate "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("millis")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    temp "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("int")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("dht"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getTempFarenheit")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    humidity "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("int")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("dht"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getHumidity")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    Serial"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("printlnf")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"Temp: %f"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" temp"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    Serial"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("printlnf")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"Humidity: %f"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" humidity"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("double")]),t._v(" lightAnalogVal "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("analogRead")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("A0"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    currentLightLevel "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("map")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lightAnalogVal"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0.0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("4095.0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0.0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("100.0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentLightLevel "),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("50")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      Particle"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("publish")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"light-meter/level"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("String")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentLightLevel"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PRIVATE"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"4"}},[s("li",[this._v("Now, let's add our BLE logic to the "),s("code",[this._v("loop")]),this._v(", after the "),s("code",[this._v("currentLightLevel")]),this._v(" if statement. In this code, we check to see if another device (a peripheral) is connected to our Argon. If so. we'll use the diagnostics library to get the device uptime, signal strength and free memory, and set those values to our characteristics, so the connected client can read them.")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BLE"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("connected")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("uint8_t")]),t._v(" uptime "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("uint8_t")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("DiagnosticsHelper"),a("span",{attrs:{class:"token operator"}},[t._v("::")]),a("span",{attrs:{class:"token function"}},[t._v("getValue")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DIAG_ID_SYSTEM_UPTIME"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  uptimeCharacteristic"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("setValue")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uptime"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("uint8_t")]),t._v(" signalStrength "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("uint8_t")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DiagnosticsHelper"),a("span",{attrs:{class:"token operator"}},[t._v("::")]),a("span",{attrs:{class:"token function"}},[t._v("getValue")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DIAG_ID_NETWORK_SIGNAL_STRENGTH"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("8")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  signalStrengthCharacteristic"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("setValue")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("signalStrength"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("int32_t")]),t._v(" usedRAM "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" DiagnosticsHelper"),a("span",{attrs:{class:"token operator"}},[t._v("::")]),a("span",{attrs:{class:"token function"}},[t._v("getValue")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DIAG_ID_SYSTEM_USED_RAM"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("int32_t")]),t._v(" totalRAM "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" DiagnosticsHelper"),a("span",{attrs:{class:"token operator"}},[t._v("::")]),a("span",{attrs:{class:"token function"}},[t._v("getValue")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DIAG_ID_SYSTEM_TOTAL_RAM"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("int32_t")]),t._v(" freeMem "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("totalRAM "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v(" usedRAM"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  freeMemoryCharacteristic"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("setValue")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("freeMem"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"5"}},[s("li",[this._v("And that's all you need on the Argon side. Flash the latest firmware to your device and move on to the next step!")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"viewing-bluetooth-data-with-web-ble-on-chrome"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#viewing-bluetooth-data-with-web-ble-on-chrome","aria-hidden":"true"}},[this._v("#")]),this._v(" Viewing Bluetooth data with Web BLE on Chrome")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{attrs:{class:"token function"}},[this._v("git")]),this._v(" clone https://github.com/bsatrom/particle-web-ble\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[this._v("Open the project in your editor of choice, and modify the following snippet in the "),s("code",[this._v("src/scripts/ble.js")]),this._v(" file to match the Service UUID you specified in your Argon code above. This code scans for available devices that match a specific UUID, so if you changed it, you should only see your device when running the app.")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" device "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" navigator"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bluetooth"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("requestDevice")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  filters"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" services"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v("'5c1b9a0d-b5be-4a40-8f7a-66b36d0a5176'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// CHANGE ME")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[this._v("In a terminal window, run "),s("code",[this._v("npm run serve")]),this._v(" to build and run the web app locally. Once the build completes, open a new browser tab or window with the URL specified in the terminal window.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(198),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"4"}},[s("li",[this._v('Click on the "Scan" Button. A pop-up will appear as Chrome scans for devices. Once your device appears, click on it and click the "Pair" button.')])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(197),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"handling-system-events"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#handling-system-events","aria-hidden":"true"}},[this._v("#")]),this._v(" Handling System Events")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Next up, let's look at how we can respond to system events sent by the Device OS in our application firmware. For this section, we'll add a system event handler to detect when the "),s("code",[this._v("MODE")]),this._v(" button on the Argon is clicked, and respond by turning on the "),s("code",[this._v("D7")]),this._v(" LED.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("Start by adding a handler function to your application. When called, we'll use the duration parameter to figure out if the button has just been pressed (hence, no duration) and when it is released. The end result is an LED that will turn on when the button is pressed, and off when it is released.")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("button_handler")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("system_event_t event"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" duration"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("void")]),a("span",{attrs:{class:"token operator"}},[t._v("*")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("duration"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("digitalWrite")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D7"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HIGH"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("digitalWrite")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D7"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LOW"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[this._v("Next we need to register the handler in the "),s("code",[this._v("setup")]),this._v(" function. Place the following at the end of your existing "),s("code",[this._v("setup")]),this._v(" function.")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("setup")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// Existing code here")]),t._v("\n\n  "),a("span",{attrs:{class:"token function"}},[t._v("pinMode")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D7"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" OUTPUT"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  System"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("button_status"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" button_handler"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[s("p",[this._v("Now flash this firmware to your device and wait for it to come back online.")])]),s("li",[s("p",[this._v("Click the "),s("code",[this._v("MODE")]),this._v(" button (the button on the left side of the device). Your D7 LED should flash briefly each time you do.")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(196),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"using-sleep-modes-to-save-power"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-sleep-modes-to-save-power","aria-hidden":"true"}},[this._v("#")]),this._v(" Using Sleep Modes to save power")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Finally, let's look at sleep modes, which is an easy-to-use way to conserve power in our applications by taking our devices offline, either for an interval, or until woken up by external stimuli. In this section, we'll extend our system event code to put our device to sleep when the "),s("code",[this._v("MODE")]),this._v(" button is clicked. We'll start by putting the device to sleep for a few seconds, and then add a button to our project that will bring the Argon back to life when clicked.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("Let's add a global boolean we can use to determine whether to go to sleep or not. Add this to the top of your program, outside of the "),s("code",[this._v("setup")]),this._v(" and "),s("code",[this._v("loop")]),this._v(" functions.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[this._v("bool")]),this._v(" timeToSleep"),s("span",{attrs:{class:"token punctuation"}},[this._v(";")]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[this._v("Now, modify the system event handler from the last section. You can keep the code that turns the LED on, and set the "),s("code",[this._v("timeToSleep")]),this._v(" boolean to true.")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("button_handler")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("system_event_t event"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" duration"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("void")]),a("span",{attrs:{class:"token operator"}},[t._v("*")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("duration"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("digitalWrite")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D7"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HIGH"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("digitalWrite")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D7"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LOW"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    timeToSleep "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ol",{attrs:{start:"3"}},[a("li",[t._v("Finally, let's check our boolean in the "),a("code",[t._v("loop")]),t._v(" and, if true, set our boolean to false and put the device to sleep. At the start of the "),a("code",[t._v("loop")]),t._v(" function, add the code below. The "),a("code",[t._v("System.sleep")]),t._v(" method is called with the "),a("code",[t._v("WKP")]),t._v(" pin on every Argon as the external pin to wake on, as well as a time delay of twenty seconds, which instructs the device to wake up even if the pin isn't triggered.")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("loop")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("timeToSleep"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    timeToSleep "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    System"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("sleep")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WKP"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" RISING"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("20")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// Existing loop code")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[s("p",[this._v("Now, flash this new firmware to your device. When your Argon comes back online, click the D7 button. When the RGB LED turns off, that means your device is sleeping. After 5 seconds, it will come back online and reconnect to the Particle Device Cloud.")])]),s("li",[s("p",[this._v("Now let's add an external button so you can explore waking a device up from sleep on a pin change. Grab the Grove Button from your IoT Starter Kit, and another Grove cable.")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(195),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"4"}},[s("li",[this._v("Plug one end of the cable into the button, and the other into the "),s("code",[this._v("D4")]),this._v(" port on the Grove shield.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(194),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"5"}},[s("li",[this._v("In your "),s("code",[this._v("setup")]),this._v(" function, set the "),s("code",[this._v("pinMode")]),this._v(" for the D4 pin to "),s("code",[this._v("INPUT")]),this._v(".")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("pinMode")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D4"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" INPUT_PULLUP"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"5"}},[s("li",[this._v("Finally, modify the "),s("code",[this._v("System.sleep")]),this._v(" call to wake your device up when the D4 pin state changes from LOW to HIGH, as in, when it is pressed.")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("loop")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("timeToSleep"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    timeToSleep "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    System"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("sleep")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D4"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" RISING"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// Existing loop code")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"6"}},[s("li",[s("p",[this._v("Flash the firmware, and when your device comes back online, click the "),s("code",[this._v("MODE")]),this._v(" button to put the device to sleep.")])]),s("li",[s("p",[this._v("Now, push the Grove button to wake your Argon back up.")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(193),alt:""}})])}],n=a(0),o=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._m(1),a("p",[t._v("In this lab, you're going to start exploring some Particle power-user features, starting with the Particle CLI and BLE, before moving onto some advanced Device OS features like system events and sleep.")]),t._m(2),t._m(3),a("ol",[a("li",[t._v("If you haven't already, "),a("a",{attrs:{href:"https://docs.particle.io/guide/tools-and-features/cli/photon/",target:"_blank",rel:"noopener noreferrer"}},[t._v("install the Particle CLI"),a("OutboundLink")],1),t._v(". Open a terminal window and type the following command:")])]),t._m(4),t._m(5),t._m(6),t._m(7),t._m(8),t._m(9),t._m(10),t._m(11),t._m(12),a("p",[t._v("Behind the scenes, every interface that Particle provides to work with devices, from the Console, to mobile apps, SDKs, and the CLI, they all talk through a RESTful Device Cloud API. You can even call yourself, directly.")]),a("p",[a("em",[t._v("The next few steps assume you have cURL installed on your machine. If you don't have this command-line utility on your machine, you can download and install it "),a("a",{attrs:{href:"https://curl.haxx.se/download.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(" or use a GUI-based tool like "),a("a",{attrs:{href:"https://www.getpostman.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Postman"),a("OutboundLink")],1),t._v(".")])]),t._m(13),t._m(14),t._m(15),t._m(16),t._m(17),t._m(18),t._m(19),t._m(20),a("p",[t._v("You've now explored a number of ways that you can interface with the Particle Device cloud and your connected devices! Now, let's go beyond the Particle ecosystem and explore some of the ways that you can integrate with other 3rd party services, and backhaul your data into other cloud services.")]),t._m(21),a("p",[t._v("For the last section of this lab, we'll explore using BLE to advertise data from your device. Specifically, we'll use BLE to advertise the uptime, WiFi signal strength and free memory on your device, which you'll then read from a browser using Web BLE and Chrome.")]),t._m(22),t._m(23),t._m(24),t._m(25),t._m(26),t._m(27),t._m(28),a("ol",{attrs:{start:"6"}},[a("li",[t._v("Now, add a UUID for the service, and three characteristic objects to represent uptime, signal strength, and free memory. The service UUID is arbitrary and you should change it from the default below using a UUID generator like the one "),a("a",{attrs:{href:"https://www.uuidgenerator.net/",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(". Keep track of the UUID you create here  because you'll need it in the next section as well. The Service UUIDs should remain unchanged.")])]),t._m(29),t._m(30),t._m(31),t._m(32),t._m(33),t._m(34),t._m(35),t._m(36),t._m(37),t._m(38),t._m(39),t._m(40),t._m(41),t._m(42),t._m(43),t._m(44),t._m(45),t._m(46),t._m(47),t._m(48),t._m(49),a("p",[t._v("There are a number of methods by which you can connect to your BLE-powered Argon. You could use a mobile app (like "),a("a",{attrs:{href:"https://apps.apple.com/us/app/adafruit-bluefruit-le-connect/id830125974",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bluefruit"),a("OutboundLink")],1),t._v(" from Adafruit), or another Particle 3rd Gen device. You can also use a browser that supports Web BLE, like Chrome, which will do in this section. At the time this lab ws created, Chrome is the only desktop browser that supports Web BLE, so you'll need to have that browser installed to")]),a("ol",[a("li",[t._v("Clone the "),a("a",{attrs:{href:"https://github.com/bsatrom/particle-web-ble",target:"_blank",rel:"noopener noreferrer"}},[t._v("demo web app"),a("OutboundLink")],1),t._v(" for this project to your machine using a terminal window")])]),t._m(50),t._m(51),t._m(52),t._m(53),t._m(54),t._m(55),t._m(56),a("p",[t._v("In the local app, the screen will update as the connection is made and data is retrieved from the device. As new data is reported to the app from the device, these values will change automatically!")]),t._m(57),t._m(58),t._m(59),t._m(60),t._m(61),t._m(62),t._m(63),t._m(64),a("p",[t._v("System events are as simple as that! For a list of other system events at your disposal, check out the "),a("a",{attrs:{href:"https://docs.particle.io/reference/device-os/firmware/electron/#system-events-reference",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs"),a("OutboundLink")],1),t._v(".")]),t._m(65),t._m(66),t._m(67),t._m(68),t._m(69),t._m(70),t._m(71),t._m(72),t._m(73),t._m(74),t._m(75),t._m(76),t._m(77),t._m(78),t._m(79),t._m(80),t._m(81),t._m(82),a("p",[t._v("Great job! For more info on using the "),a("code",[t._v("sleep")]),t._v(" API, "),a("a",{attrs:{href:"https://docs.particle.io/reference/device-os/firmware/electron/#sleep-sleep-",target:"_blank",rel:"noopener noreferrer"}},[t._v("check out the docs"),a("OutboundLink")],1),t._v(".")])])},e,!1,null,null,null);s.default=o.exports}}]);