<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab 3: Exploring BLE and Advanced Device OS Features | Particle Accelerate Workshop</title>
    <meta name="description" content="Workshops designed to teach the basics of IoT development with the Particle ecosystem &amp; the Particle Argon">
    
    
    <link rel="preload" href="/assets/css/7.styles.c68e7648.css" as="style"><link rel="preload" href="/assets/js/app.39e44bcc.js" as="script"><link rel="preload" href="/assets/js/2.af587cdc.js" as="script"><link rel="prefetch" href="/assets/js/0.d00745c3.js"><link rel="prefetch" href="/assets/js/1.50ccb48d.js"><link rel="prefetch" href="/assets/js/3.0be71798.js"><link rel="prefetch" href="/assets/js/4.bb2b32e2.js"><link rel="prefetch" href="/assets/js/5.4579ae6b.js"><link rel="prefetch" href="/assets/js/6.882f13d7.js">
    <link rel="stylesheet" href="/assets/css/7.styles.c68e7648.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Particle Accelerate Workshop
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://particle.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Team
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><a href="https://github.com/particle-iot/spectra-workshop-2020" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://particle.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Team
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><a href="https://github.com/particle-iot/spectra-workshop-2020" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><a href="/docs/" class="sidebar-link">About Particle Workshops</a></li><li><a href="/docs/ch1.html" class="sidebar-link">Lab 1: Getting your Particle Argon online</a></li><li><a href="/docs/ch2.html" class="sidebar-link">Lab 2: Working with Particle Workbench &amp; Primitives</a></li><li><a href="/docs/ch3.html" class="active sidebar-link">Lab 3: Exploring BLE &amp; Advanced Device OS Features</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/ch3.html#working-with-bluetooth-on-particle-devices" class="sidebar-link">Working with Bluetooth on Particle Devices</a></li></ul></li><li><a href="/docs/ch4.html" class="sidebar-link">Lab 4: Exploring Particle SDKs &amp; Integrations</a></li><li><a href="/docs/extra.html" class="sidebar-link">Extra: Going Even Further!</a></li></ul></div><div class="page"><div class="content"><h1 id="lab-3-exploring-ble-and-advanced-device-os-features"><a href="#lab-3-exploring-ble-and-advanced-device-os-features" aria-hidden="true" class="header-anchor">#</a> Lab 3: Exploring BLE and Advanced Device OS Features</h1><table><thead><tr><th><strong>Project Goal</strong></th><th>Use Particle Webhooks and Integrations to connect your app to IFTTT; Learn to perform on-device debugging in Particle Workbench.</th></tr></thead><tbody><tr><td><strong>What you’ll learn</strong></td><td>Working with Particle Integrations, IFTTT, and on-devie debugging in Particle Workbench</td></tr><tr><td><strong>Tools you’ll need</strong></td><td>Particle Workbench, an <a href="https://ifttt.com" target="_blank" rel="noopener noreferrer">IFTTT.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> account, a Particle Argon, and the Grove Starter Kit for Particle Mesh, a Particle Debugger.</td></tr><tr><td><strong>Time needed to complete</strong></td><td>60 minutes</td></tr></tbody></table><h2 id="working-with-bluetooth-on-particle-devices"><a href="#working-with-bluetooth-on-particle-devices" aria-hidden="true" class="header-anchor">#</a> Working with Bluetooth on Particle Devices</h2><p>For the last section of this lab, we'll explore using BLE to advertise data from your device. Specifically, we'll use BLE to advertise the uptime, WiFi signal strength and free memory on your device, which you'll then read from a browser using Web BLE and Chrome.</p><h3 id="using-bluetooth-with-particle-gen3-devices"><a href="#using-bluetooth-with-particle-gen3-devices" aria-hidden="true" class="header-anchor">#</a> Using Bluetooth with Particle Gen3 Devices</h3><ol><li><p>To use Bluetooth with a Gen3 device, you'll need to be running Device OS version 1.3.0 or greater. To set this in Workbench, open the command palette (SHIFT + CMD/CTRL + P), select the &quot;Configure Project for Device&quot; option and select version &quot;deviceOS@1.3.0&quot; or newer.</p></li><li><p>Next, you'll want to install a new library to help with getting power and battery info from your device. Open the command palette, select the &quot;Install Library&quot; command and enter &quot;DiagnosticsHelperRK&quot; into the textbox. Hit enter and the library will be installed.</p></li><li><p>At the top of your project, add an include for the DiagnosticsHelper library.</p></li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;DiagnosticsHelperRK.h&quot;</span></span>
</code></pre></div><ol start="4"><li>Now, let's turn on threading in the app, using the <code>SYSTEM_THREAD</code> command below. This opt-in change will allow your user firmware and system firmware to run on separate threads, which can speed things up when you're doing cloud publishes and local operations like Bluetooth.</li></ol><div class="language- extra-class"><pre class="language-text"><code>SYSTEM_THREAD(ENABLED);
</code></pre></div><ol start="5"><li>Next, add some global variables to handle timing for updating the device state values outside of the <code>setup</code> and <code>loop</code> functions.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> UPDATE_INTERVAL <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> lastUpdate <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div><ol start="6"><li>Now, add a UUID for the service, and three characteristic objects to represent uptime, signal strength, and free memory. The service UUID is arbitrary and you should change it from the default below using a UUID generator like the one <a href="https://www.uuidgenerator.net/" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Keep track of the UUID you create here  because you'll need it in the next section as well. The Service UUIDs should remain unchanged.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Private battery and power service UUID</span>
<span class="token keyword">const</span> BleUuid <span class="token function">serviceUuid</span><span class="token punctuation">(</span><span class="token string">&quot;5c1b9a0d-b5be-4a40-8f7a-66b36d0a5176&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// CHANGE ME</span>

BleCharacteristic <span class="token function">uptimeCharacteristic</span><span class="token punctuation">(</span><span class="token string">&quot;uptime&quot;</span><span class="token punctuation">,</span> BleCharacteristicProperty<span class="token operator">::</span>NOTIFY<span class="token punctuation">,</span> <span class="token function">BleUuid</span><span class="token punctuation">(</span><span class="token string">&quot;fdcf4a3f-3fed-4ed2-84e6-04bbb9ae04d4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> serviceUuid<span class="token punctuation">)</span><span class="token punctuation">;</span>
BleCharacteristic <span class="token function">signalStrengthCharacteristic</span><span class="token punctuation">(</span><span class="token string">&quot;strength&quot;</span><span class="token punctuation">,</span> BleCharacteristicProperty<span class="token operator">::</span>NOTIFY<span class="token punctuation">,</span> <span class="token function">BleUuid</span><span class="token punctuation">(</span><span class="token string">&quot;cc97c20c-5822-4800-ade5-1f661d2133ee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> serviceUuid<span class="token punctuation">)</span><span class="token punctuation">;</span>
BleCharacteristic <span class="token function">freeMemoryCharacteristic</span><span class="token punctuation">(</span><span class="token string">&quot;freeMemory&quot;</span><span class="token punctuation">,</span> BleCharacteristicProperty<span class="token operator">::</span>NOTIFY<span class="token punctuation">,</span> <span class="token function">BleUuid</span><span class="token punctuation">(</span><span class="token string">&quot;d2b26bf3-9792-42fc-9e8a-41f6107df04c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> serviceUuid<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="7"><li>Next, create a function to configure and set-up BLE advertising from your device. This snippet will add the three characteristics you defined above, as well as the service UUID you specified, and will advertise itself as a connectable device.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">configureBLE</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  BLE<span class="token punctuation">.</span><span class="token function">addCharacteristic</span><span class="token punctuation">(</span>uptimeCharacteristic<span class="token punctuation">)</span><span class="token punctuation">;</span>
  BLE<span class="token punctuation">.</span><span class="token function">addCharacteristic</span><span class="token punctuation">(</span>signalStrengthCharacteristic<span class="token punctuation">)</span><span class="token punctuation">;</span>
  BLE<span class="token punctuation">.</span><span class="token function">addCharacteristic</span><span class="token punctuation">(</span>freeMemoryCharacteristic<span class="token punctuation">)</span><span class="token punctuation">;</span>

  BleAdvertisingData advData<span class="token punctuation">;</span>

  <span class="token comment">// Advertise our private service only</span>
  advData<span class="token punctuation">.</span><span class="token function">appendServiceUUID</span><span class="token punctuation">(</span>serviceUuid<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Continuously advertise when not connected</span>
  BLE<span class="token punctuation">.</span><span class="token function">advertise</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>advData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="8"><li>At the end of your <code>setup</code> function, call the function you just created.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">configureBLE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="refactoring-out-the-blocking-delay"><a href="#refactoring-out-the-blocking-delay" aria-hidden="true" class="header-anchor">#</a> Refactoring out the blocking delay</h3><p>Next, let's modify the <code>loop</code> function. We'll start by refactoring our firmware to remove the <code>delay</code> in the loop. While the delay approach is common when getting started with creating embedded applications, it's a blocking operation. This means that any calls you make to the device during a delay may timeout before being received.</p><p>One common way to write periodic code without using <code>delay</code> is to use the built-in <code>millis()</code> function and keep track of the elapsed time between the last time you performed an operation (like a temp check) and the wait time between operations.</p><ol><li>First, let's add some global variables to hold the last check time and an interval. Add the following to the top of your project, outside of the <code>setup</code> and <code>loop</code>.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> UPDATE_INTERVAL <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> lastUpdate <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>Now, in the <code>loop</code>, add a local variable to hold the current time elapsed. The <code>millis()</code> function returns the number of milliseconds that have elapsed since your device began running the current program.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">unsigned</span> <span class="token keyword">long</span> currentMillis <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>Next, remove the <code>delay</code> at the end of your loop function. Then, wrap the rest of the code with an if statement to see if the <code>UPDATE_INTERVAL</code> time has elapsed.</li></ol><p>Make sure you also update the <code>lastUpdate</code> variable to the current <code>millis</code> time or this <code>if</code> statement will never evaluate to <code>true</code> after the first time it runs.</p><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>currentMillis <span class="token operator">-</span> lastUpdate <span class="token operator">&gt;=</span> UPDATE_INTERVAL<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  lastUpdate <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* rest of Loop code here */</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>Your <code>loop</code> should now look like this:</p><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">long</span> currentMillis <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentMillis <span class="token operator">-</span> lastUpdate <span class="token operator">&gt;=</span> UPDATE_INTERVAL<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    lastUpdate <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    temp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>dht<span class="token punctuation">.</span><span class="token function">getTempFarenheit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    humidity <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>dht<span class="token punctuation">.</span><span class="token function">getHumidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Serial<span class="token punctuation">.</span><span class="token function">printlnf</span><span class="token punctuation">(</span><span class="token string">&quot;Temp: %f&quot;</span><span class="token punctuation">,</span> temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">printlnf</span><span class="token punctuation">(</span><span class="token string">&quot;Humidity: %f&quot;</span><span class="token punctuation">,</span> humidity<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">double</span> lightAnalogVal <span class="token operator">=</span> <span class="token function">analogRead</span><span class="token punctuation">(</span>A0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    currentLightLevel <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>lightAnalogVal<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">4095.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentLightLevel <span class="token operator">&gt;</span> <span class="token number">50</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Particle<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">&quot;light-meter/level&quot;</span><span class="token punctuation">,</span> <span class="token function">String</span><span class="token punctuation">(</span>currentLightLevel<span class="token punctuation">)</span><span class="token punctuation">,</span> PRIVATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>Now, let's add our BLE logic to the <code>loop</code>, after the <code>currentLightLevel</code> if statement. In this code, we check to see if another device (a peripheral) is connected to our Argon. If so. we'll use the diagnostics library to get the device uptime, signal strength and free memory, and set those values to our characteristics, so the connected client can read them.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>BLE<span class="token punctuation">.</span><span class="token function">connected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">uint8_t</span> uptime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token punctuation">)</span>DiagnosticsHelper<span class="token operator">::</span><span class="token function">getValue</span><span class="token punctuation">(</span>DIAG_ID_SYSTEM_UPTIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
  uptimeCharacteristic<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>uptime<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">uint8_t</span> signalStrength <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DiagnosticsHelper<span class="token operator">::</span><span class="token function">getValue</span><span class="token punctuation">(</span>DIAG_ID_NETWORK_SIGNAL_STRENGTH<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  signalStrengthCharacteristic<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>signalStrength<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">int32_t</span> usedRAM <span class="token operator">=</span> DiagnosticsHelper<span class="token operator">::</span><span class="token function">getValue</span><span class="token punctuation">(</span>DIAG_ID_SYSTEM_USED_RAM<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int32_t</span> totalRAM <span class="token operator">=</span> DiagnosticsHelper<span class="token operator">::</span><span class="token function">getValue</span><span class="token punctuation">(</span>DIAG_ID_SYSTEM_TOTAL_RAM<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int32_t</span> freeMem <span class="token operator">=</span> <span class="token punctuation">(</span>totalRAM <span class="token operator">-</span> usedRAM<span class="token punctuation">)</span><span class="token punctuation">;</span>
  freeMemoryCharacteristic<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>freeMem<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="5"><li>And that's all you need on the Argon side. Flash the latest firmware to your device and move on to the next step!</li></ol><h3 id="viewing-bluetooth-data-with-web-ble-on-chrome"><a href="#viewing-bluetooth-data-with-web-ble-on-chrome" aria-hidden="true" class="header-anchor">#</a> Viewing Bluetooth data with Web BLE on Chrome</h3><p>There are a number of methods by which you can connect to your BLE-powered Argon. You could use a mobile app (like <a href="https://apps.apple.com/us/app/adafruit-bluefruit-le-connect/id830125974" target="_blank" rel="noopener noreferrer">Bluefruit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> from Adafruit), or another Particle 3rd Gen device. You can also use a browser that supports Web BLE, like Chrome, which will do in this section. At the time this lab ws created, Chrome is the only desktop browser that supports Web BLE, so you'll need to have that browser installed to</p><ol><li>Clone the <a href="https://github.com/bsatrom/particle-web-ble" target="_blank" rel="noopener noreferrer">demo web app<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for this project to your machine using a terminal window</li></ol><div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> clone https://github.com/bsatrom/particle-web-ble
</code></pre></div><ol start="2"><li>Open the project in your editor of choice, and modify the following snippet in the <code>src/scripts/ble.js</code> file to match the Service UUID you specified in your Argon code above. This code scans for available devices that match a specific UUID, so if you changed it, you should only see your device when running the app.</li></ol><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> device <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>bluetooth<span class="token punctuation">.</span><span class="token function">requestDevice</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  filters<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> services<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'5c1b9a0d-b5be-4a40-8f7a-66b36d0a5176'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token comment">// CHANGE ME</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>In a terminal window, run <code>npm run serve</code> to build and run the web app locally. Once the build completes, open a new browser tab or window with the URL specified in the terminal window.</li></ol><p><img src="/assets/img/vue-serve.f839b7c7.png" alt></p><ol start="4"><li>Click on the &quot;Scan&quot; Button. A pop-up will appear as Chrome scans for devices. Once your device appears, click on it and click the &quot;Pair&quot; button.</li></ol><p><img src="/assets/img/ble-demo.a3d8e1b0.gif" alt></p><p>In the local app, the screen will update as the connection is made and data is retrieved from the device. As new data is reported to the app from the device, these values will change automatically!</p></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/particle-iot/spectra-workshop-2020/edit/master/content/docs/ch3.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/docs/ch2.html" class="prev">
          Lab 2: Working with Particle Workbench &amp; Primitives
        </a></span><span class="next"><a href="/docs/ch4.html">
          Lab 4: Exploring Particle SDKs &amp; Integrations
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/2.af587cdc.js" defer></script><script src="/assets/js/app.39e44bcc.js" defer></script>
  </body>
</html>
